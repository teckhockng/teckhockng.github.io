<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" charset="utf-8" content="width=device-width"/>
  <title>Scrape Data For NBA Win Prediction</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.min.css">
    <link rel="stylesheet" href="https://teckhockng.github.io/theme/css/main.9f548f79.css">
    <link rel="stylesheet" href="https://teckhockng.github.io/theme/webassets-external/010418e8be77eba9c979b3618bbf36f4_print.css" media="print">
  <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
<meta property="og:title" content="Teck Hock NG - Scrape Data For NBA Win Prediction">
  <meta property="og:description" content="from gazpacho import get, Soup import time from tqdm import tqdm import pandas as pd import numpy as np import re import datetime as DT The url of the first 100 games for each season # Base url...">
<meta property="og:url" content="https://teckhockng.github.io/scrape-data-for-nba-win-prediction.html">
<meta name="twitter:card" content="summary">
</head>

<style>
.nav.has-shadow{
  visibility: hidden;
}
</style>
<body id="index" class="home">
<header class="hero is-primary">
  <div class="hero-head">
    <div class="container">
      <nav class="nav">
        <div class="nav-left">
          <a class="nav-item is-brand title is-3"
             href="https://teckhockng.github.io/">Teck Hock NG</a>
        </div>
        <div class="nav-right">
              <a class="nav-item is-tab "
                 href="https://teckhockng.github.io/category/visualization.html">Visualization</a>
              <a class="nav-item is-tab "
                 href="https://teckhockng.github.io/category/regressor.html">Regressor</a>
              <a class="nav-item is-tab "
                 href="https://teckhockng.github.io/category/nlp.html">NLP</a>
              <a class="nav-item is-tab "
                 href="https://teckhockng.github.io/category/flask.html">Flask</a>
              <a class="nav-item is-tab is-active"
                 href="https://teckhockng.github.io/category/classifier.html">Classifier</a>
        </div>
      </nav>
    </div>
  </div>
</header>

<nav class="nav has-shadow is-hidden-print">
  <!-- <div class="container">
    <div class="nav-center"></div>
    <span id="navToggle" class="nav-toggle">
      <span></span>
      <span></span>
      <span></span>
    </span>
    <div id="navMenu" class="nav-right">
          <a class="nav-item is-tab "
             href="https://teckhockng.github.io/category/visualization.html">Visualization</a>
          <a class="nav-item is-tab "
             href="https://teckhockng.github.io/category/regressor.html">Regressor</a>
          <a class="nav-item is-tab "
             href="https://teckhockng.github.io/category/nlp.html">NLP</a>
          <a class="nav-item is-tab "
             href="https://teckhockng.github.io/category/flask.html">Flask</a>
          <a class="nav-item is-tab is-active"
             href="https://teckhockng.github.io/category/classifier.html">Classifier</a>
    </div>
  </div> -->
</nav>

<div class="container">
  <div class="section columns">
    <div class="column is-three-quarters-desktop is-two-thirds-tablet">
<section id="content" class="body">
  <article>
    <h1 class="title">
      <a href="https://teckhockng.github.io/scrape-data-for-nba-win-prediction.html" rel="bookmark"
         title="Permalink to Scrape Data For NBA Win Prediction">Scrape Data For NBA Win Prediction</a></h1>
<footer class="post-info">
  <abbr class="published" title="2019-11-11T00:00:00-05:00">
    Published <span class="is-info">Mon 11 November 2019</span>
    in <a href="https://teckhockng.github.io/category/classifier.html">Classifier</a>
  </abbr>

    <p class="author">
      <em>by           <a class="url fn" href="https://teckhockng.github.io/author/teck-hock-ng.html">Teck Hock Ng</a>
</em>
      <span class="tag is-small"><a href="https://teckhockng.github.io/tag/python.html">python</a></span>
    </p>
  
</footer>    <div class="section"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">gazpacho</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">Soup</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">DT</span>
</code></pre></div>

<h3>The url of the first 100 games for each season</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Base url for season 2017-2018</span>
<span class="n">season_17_18_base_url</span> <span class="o">=</span> <span class="s2">&quot;https://www.basketball-reference.com/play-index/tgl_finder.cgi?request=1&amp;match=game&amp;lg_id=NBA&amp;team_seed_cmp=eq&amp;opp_seed_cmp=eq&amp;year_min=2018&amp;year_max=2018&amp;is_range=N&amp;game_num_type=team&amp;order_by=date_game&quot;</span>
<span class="c1"># Base url for season 2018-2019</span>
<span class="n">season_18_19_base_url</span> <span class="o">=</span> <span class="s2">&quot;https://www.basketball-reference.com/play-index/tgl_finder.cgi?request=1&amp;match=game&amp;lg_id=NBA&amp;team_seed_cmp=eq&amp;opp_seed_cmp=eq&amp;year_min=2019&amp;year_max=2019&amp;is_range=N&amp;game_num_type=team&amp;order_by=date_game&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_pbp_links</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;data-stat&#39;</span><span class="p">:</span> <span class="s1">&#39;date_game&#39;</span><span class="p">})</span>
    <span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">pbp_links</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;https://www.basketball-reference.com&quot;</span> <span class="o">+</span> <span class="n">l</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;scores/&#39;</span><span class="p">,</span><span class="s1">&#39;scores/pbp/&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">links</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pbp_links</span>
</code></pre></div>

<h3>Create a new list to store the urls</h3>
<div class="highlight"><pre><span></span><code><span class="n">pbp_links_17_18</span> <span class="o">=</span> <span class="n">get_pbp_links</span><span class="p">(</span><span class="n">season_17_18_base_url</span><span class="p">)</span>
</code></pre></div>

<h3>Loop through the pages and insert the urls into the list created previously</h3>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2624</span><span class="p">,</span> <span class="mi">100</span><span class="p">)):</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">_</span>
    <span class="n">season_17_18_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.basketball-reference.com/play-index/tgl_finder.cgi?request=1&amp;player=&amp;match=game&amp;lg_id=NBA&amp;year_min=2018&amp;year_max=2018&amp;team_id=&amp;opp_id=&amp;is_range=N&amp;is_playoffs=&amp;round_id=&amp;best_of=&amp;team_seed=&amp;opp_seed=&amp;team_seed_cmp=eq&amp;opp_seed_cmp=eq&amp;game_num_type=team&amp;game_num_min=&amp;game_num_max=&amp;game_month=&amp;game_location=&amp;game_result=&amp;is_overtime=&amp;c1stat=&amp;c1comp=&amp;c1val=&amp;c2stat=&amp;c2comp=&amp;c2val=&amp;c3stat=&amp;c3comp=&amp;c3val=&amp;c4stat=&amp;c4comp=&amp;c4val=&amp;order_by=date_game&amp;order_by_asc=&amp;offset=</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">links</span> <span class="o">=</span> <span class="n">get_pbp_links</span><span class="p">(</span><span class="n">season_17_18_url</span><span class="p">)</span>
    <span class="n">pbp_links_17_18</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">100</span><span class="err">%|██████████|</span><span class="w"> </span><span class="mf">26</span><span class="o">/</span><span class="mf">26</span><span class="w"> </span><span class="err">[</span><span class="mf">01</span><span class="p">:</span><span class="mf">13</span><span class="o">&lt;</span><span class="mf">00</span><span class="p">:</span><span class="mf">00</span><span class="p">,</span><span class="w">  </span><span class="mf">3.68</span><span class="n">s</span><span class="o">/</span><span class="n">it</span><span class="err">]</span><span class="w"></span>
</code></pre></div>

<h3>Even though there are 2624 links scraped but half of them are unique</h3>
<div class="highlight"><pre><span></span><code><span class="nb">len</span><span class="p">(</span><span class="n">pbp_links_17_18</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">2624</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">pbp_links_17_18</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pbp_links_17_18</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">pbp_links_17_18</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">1312</span><span class="w"></span>
</code></pre></div>

<h3>Repeat the same step for season 18-19</h3>
<div class="highlight"><pre><span></span><code><span class="n">pbp_links_18_19</span> <span class="o">=</span> <span class="n">get_pbp_links</span><span class="p">(</span><span class="n">season_18_19_base_url</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># loop through season 18_19 games</span>
<span class="c1"># change url offset</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2624</span><span class="p">,</span> <span class="mi">100</span><span class="p">)):</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">_</span>
    <span class="n">season_18_19_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.basketball-reference.com/play-index/tgl_finder.cgi?request=1&amp;player=&amp;match=game&amp;lg_id=NBA&amp;year_min=2019&amp;year_max=2019&amp;team_id=&amp;opp_id=&amp;is_range=N&amp;is_playoffs=&amp;round_id=&amp;best_of=&amp;team_seed=&amp;opp_seed=&amp;team_seed_cmp=eq&amp;opp_seed_cmp=eq&amp;game_num_type=team&amp;game_num_min=&amp;game_num_max=&amp;game_month=&amp;game_location=&amp;game_result=&amp;is_overtime=&amp;c1stat=&amp;c1comp=&amp;c1val=&amp;c2stat=&amp;c2comp=&amp;c2val=&amp;c3stat=&amp;c3comp=&amp;c3val=&amp;c4stat=&amp;c4comp=&amp;c4val=&amp;order_by=date_game&amp;order_by_asc=&amp;offset=</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">links</span> <span class="o">=</span> <span class="n">get_pbp_links</span><span class="p">(</span><span class="n">season_18_19_url</span><span class="p">)</span>
    <span class="n">pbp_links_18_19</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">100</span><span class="err">%|██████████|</span><span class="w"> </span><span class="mf">26</span><span class="o">/</span><span class="mf">26</span><span class="w"> </span><span class="err">[</span><span class="mf">01</span><span class="p">:</span><span class="mf">47</span><span class="o">&lt;</span><span class="mf">00</span><span class="p">:</span><span class="mf">00</span><span class="p">,</span><span class="w">  </span><span class="mf">4.37</span><span class="n">s</span><span class="o">/</span><span class="n">it</span><span class="err">]</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Number of unique links</span>
<span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pbp_links_18_19</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">1312</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">pbp_links_18_19</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pbp_links_18_19</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">pbp_links_18_19</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>array([&#39;https://www.basketball-reference.com/boxscores/pbp/201810160BOS.html&#39;,
       &#39;https://www.basketball-reference.com/boxscores/pbp/201810160GSW.html&#39;,
       &#39;https://www.basketball-reference.com/boxscores/pbp/201810170CHO.html&#39;,
       ...,
       &#39;https://www.basketball-reference.com/boxscores/pbp/201906070GSW.html&#39;,
       &#39;https://www.basketball-reference.com/boxscores/pbp/201906100TOR.html&#39;,
       &#39;https://www.basketball-reference.com/boxscores/pbp/201906130GSW.html&#39;],
      dtype=&#39;&lt;U68&#39;)
</code></pre></div>

<h1>Defining different methods to get play-by-play data from each game</h1>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">scores</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">get_table_data</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">times</span><span class="p">,</span>
    <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">scores</span>
    <span class="p">})</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[0-9]{1,2}:[0-9]</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_played</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">])</span>

    <span class="c1">#remove duplicates</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># remove indicator of start/end of quarter</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)]</span>

    <span class="n">home</span><span class="p">,</span> <span class="n">away</span> <span class="o">=</span> <span class="n">strip_score</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">home</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">away</span>

    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">append_score_data</span><span class="p">(</span><span class="n">pbp_links_17_18</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>home</th>
      <th>away</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.266667</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.550000</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.616667</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.650000</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.700000</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
<h4>What the function does:</h4>
<h5>Find <code>&lt;table&gt; tag with id="pbp"</code> and from the table find <code>&lt;td&gt; with class="center"</code> where the <td> tag contains</h5>
<h5>information about scores and start/end of quarter.</h5>
<h5>Inside each table rows <tr>, the first <td> contains the time.</h5>
<h5>So, append them into list and you get the scores and times list</h5>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_table_data</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">Soup</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;pbp&#39;</span><span class="p">})</span>
    <span class="n">table_data</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">})</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">table_data</span><span class="p">]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">,</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">scores</span><span class="p">,</span> <span class="n">times</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">times</span><span class="p">,</span>
    <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">scores</span>
<span class="p">})</span>
</code></pre></div>

<h3>Use regex to find anything that is 2 numbers separated by ":" and the following 2 numbers</h3>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[0-9]{1,2}:[0-9]</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_played</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">])</span>
</code></pre></div>

<h3>Convert the time into DateTime object with the following code:</h3>
<div class="highlight"><pre><span></span><code><span class="n">t</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;%M:%S&#39;</span><span class="p">)</span>
</code></pre></div>

<h3>Then using the other DateTime object <em>q1 = DT.datetime(1900,1,1,0,12)</em> to subract the converted DateTime</h3>
<h3>object to get a TimeDelta and use total_seconds()/60 to find the minutes played</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">time_played</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">scores</span><span class="p">):</span>
    <span class="c1"># Will make this neat when I have time</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">q3</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
    <span class="n">q4</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
    <span class="n">ot1</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">53</span><span class="p">)</span>
    <span class="n">ot2</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">58</span><span class="p">)</span>
    <span class="n">ot3</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ot4</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ot5</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span>

    <span class="n">second_quart_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">third_quart_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fourth_quart_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ot_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">time_played</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">t</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">scores</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;%M:%S&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;Start of 2nd quarter&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">second_quart_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="s1">&#39;Start of 3rd quarter&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">third_quart_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="s1">&#39;Start of 4th quarter&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">fourth_quart_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;Start&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="s1">&#39;overtime&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">):</span>
            <span class="n">ot_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="s1">&#39;End of 2nd quarter&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">second_quart_counter</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="s1">&#39;End of 3rd quarter&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">third_quart_counter</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="s1">&#39;End of 4th quarter&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">fourth_quart_counter</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">second_quart_counter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">q2</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="n">time_played</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">third_quart_counter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="n">time_played</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fourth_quart_counter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">q4</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="n">time_played</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ot_counter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">ot1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="n">time_played</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ot_counter</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">ot2</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="n">time_played</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ot_counter</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">ot3</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="n">time_played</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ot_counter</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">ot4</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="n">time_played</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ot_counter</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">ot5</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="n">time_played</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
            <span class="n">time_played</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time_played</span>
</code></pre></div>

<h3>Use regex to find anything that is up to 3 numbers ending with "-" and assign it to away team</h3>
<h3>Then find up to 3 number starting with "-" and assign it to home team</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">strip_score</span><span class="p">(</span><span class="n">score</span><span class="p">):</span>
    <span class="n">home</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">away</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">score</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[0-9]{1,3}$&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[0-9]{1,3}&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">home</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">away</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">home</span><span class="p">,</span> <span class="n">away</span>
</code></pre></div>

<h3>Determine whether home team win or lose and set that as the result(y) for the dataset</h3>
<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;away&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">home_win</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;away&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_win&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">home_win</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;home&#39;</span><span class="p">])</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">nthock</span><span class="o">/</span><span class="nv">anaconda3</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">python3</span>.<span class="mi">7</span><span class="o">/</span><span class="nv">site</span><span class="o">-</span><span class="nv">packages</span><span class="o">/</span><span class="nv">ipykernel_launcher</span>.<span class="nv">py</span>:<span class="mi">1</span>: <span class="nv">SettingWithCopyWarning</span>:
<span class="nv">A</span> <span class="nv">value</span> <span class="nv">is</span> <span class="nv">trying</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">set</span> <span class="nv">on</span> <span class="nv">a</span> <span class="nv">copy</span> <span class="nv">of</span> <span class="nv">a</span> <span class="nv">slice</span> <span class="nv">from</span> <span class="nv">a</span> <span class="nv">DataFrame</span>.
<span class="nv">Try</span> <span class="nv">using</span> .<span class="nv">loc</span>[<span class="nv">row_indexer</span>,<span class="nv">col_indexer</span>] <span class="o">=</span> <span class="nv">value</span> <span class="nv">instead</span>

<span class="nv">See</span> <span class="nv">the</span> <span class="nv">caveats</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">documentation</span>: <span class="nv">http</span>:<span class="o">//</span><span class="nv">pandas</span>.<span class="nv">pydata</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">pandas</span><span class="o">-</span><span class="nv">docs</span><span class="o">/</span><span class="nv">stable</span><span class="o">/</span><span class="nv">indexing</span>.<span class="nv">html</span>#<span class="nv">indexing</span><span class="o">-</span><span class="nv">view</span><span class="o">-</span><span class="nv">versus</span><span class="o">-</span><span class="nv">copy</span>
  <span class="s2">&quot;&quot;&quot;</span><span class="s">Entry point for launching an IPython kernel.</span>
</code></pre></div>

<h3>Lastly, add the DataFrame for each game together.</h3></div>

  </article>
</section>
    </div>

    <div class="column is-one-quarter-desktop is-one-third-tablet is-hidden-print">
      <aside class="menu">
          <p class="menu-label">Links</p>
          <ul class="menu-list">
              <li><a href="https://nba-live-win-probability-predictor.ca/">
                <span class="icon is-small"><i class="fa fa-globe fa-fw"></i></span>
                <span class="link-text">NBA Win Probability Predictor</span>
              </a></li>
              <li><a href="https://ted-talk-viral-predictor.herokuapp.com/">
                <span class="icon is-small"><i class="fa fa-globe fa-fw"></i></span>
                <span class="link-text">TED Talk Virality Predictor Hackathon</span>
              </a></li>
              <li><a href="https://world-happiness-ranking.herokuapp.com/">
                <span class="icon is-small"><i class="fa fa-globe fa-fw"></i></span>
                <span class="link-text">World Happiness Ranking App</span>
              </a></li>
          </ul>
<p class="menu-label">Social</p>
<ul class="menu-list">
    <li><a href="https://www.linkedin.com/in/teckhockng/">
      <span class="icon is-small">
          <i class="fa fa-linkedin fa-fw"></i>
      </span>
      <span class="link-text">LinkedIn</span>
    </a></li>
    <li><a href="https://github.com/teckhockng">
      <span class="icon is-small">
          <i class="fa fa-github fa-fw"></i>
      </span>
      <span class="link-text">GitHub</span>
    </a></li>
</ul>      </aside>
    </div>
  </div>
</div>

<footer class="footer">
  <div class="container has-text-centered">
    <p><span class="icon is-small"><i class="fa fa-html5"></i></span> HTML 5
      | <span class="icon is-small"><i class="fa fa-css3"></i></span> CSS 3
    </p>
  </div>
</footer>

<script type="text/javascript">
  document.getElementById('navToggle').addEventListener('click', function () {
    var nav = document.getElementById('navMenu');
    var className = nav.getAttribute('class');
    if (className == 'nav-right nav-menu') {
      nav.className = 'nav-right nav-menu is-active';
    } else {
      nav.className = 'nav-right nav-menu';
    }
  });
</script>
</body>
</html>